<div class="visits-shell" [class.dimmed]="showingConfirm">
  <div class="header-row">
    <div>
      <h1>{{ 'visits.active.title' | translate }}</h1>
      <p>{{ 'visits.active.subtitle' | translate }}</p>
    </div>

    <div class="counter-pill">
      <span class="dot"></span>
      {{ totalAtivos }}
      {{ totalAtivos !== 1 ? ('visits.active.pill_plural' | translate) : ('visits.active.pill_single' | translate) }}
    </div>
  </div>

  <div class="box">
    <div class="box-head">
      <div class="title-left">
        <div class="round-icon">
          <mat-icon>list</mat-icon>
        </div>
        <div>
          <h2>{{ 'visits.active.list_title' | translate }}</h2>
          <p>{{ 'visits.active.list_subtitle' | translate }}</p>
        </div>
      </div>
      <app-export [actions]="exportActions" [disabled]="!rows.length" (action)="onExport($event)">
      </app-export>

    </div>

    <app-filters [form]="filterForm" [config]="filterConfig" (clear)="clearFilters()">
    </app-filters>

    <app-table [data]="rows" [columns]="columns" class="active-table" (cellAction)="onTableCellAction($event)">

      <!-- Visitante -->
      <ng-template appTableCell="visitante" let-row>
        <div class="td col-visitante">
          <div class="avatar">{{ initials(row.visitante.nome) }}</div>
          <div class="v-stack">
            <div class="name">{{ row.visitante.nome }}</div>
            <div class="sub">{{ row.visitante.empresa }}</div>
          </div>
        </div>
      </ng-template>

      <!-- Localização -->
      <ng-template appTableCell="localizacao" let-row>
        <div class="td col-local">
          <div class="loc-line">
            <span>{{ row.localizacao.departamento }}</span>
          </div>
          <div class="loc-line sub small">
            <span>{{ row.localizacao.sala }}</span>
          </div>
        </div>
      </ng-template>

      <!-- Motivo -->
      <ng-template appTableCell="motivo" let-row>
        <span class="badge">{{ row.motivo }}</span>
      </ng-template>

      <!-- Duração -->
      <ng-template appTableCell="duracao" let-row>
        <div class="td col-dur">
          <span>{{ row.duracao }}</span>
        </div>
      </ng-template>

      <!-- Template: Ações -->
      <ng-template appTableCell="acoes" let-row let-col="col" let-table="table">
        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="table.onCellAction(col.key, row, $event)">
            <mat-icon>exit_to_app</mat-icon>
            <span>{{ 'visits.actions.register_exit' | translate }}</span>
          </button>
        </mat-menu>
      </ng-template>

    </app-table>
    <app-pagination [length]="total" [pageSize]="10" [pageSizeOptions]="[5,10,20]" (page)="onPage($event)">
    </app-pagination>
  </div>
</div>

<!-- overlay / confirm reutilizável -->
<app-confirm-overlay *ngIf="showingConfirm"
  [title]="'visits.actions.register_exit' | translate"
  [message]="'visits.active.confirm_message' | translate"
  (cancel)="onCancelExit()"
  [show]="showingConfirm"
  (confirm)="onConfirmExit()">
</app-confirm-overlay>

<!-- toast -->
<div class="toast" *ngIf="showToast">
  <mat-icon>check_circle</mat-icon>
  <div>
    <div class="t-title">{{ 'visits.active.toast_success_title' | translate }}</div>
    <div class="t-sub">{{ lastToastMsg }}</div>
  </div>
</div>