<div class="visits-shell" [class.dimmed]="showingConfirm">
  <div class="header-row">
    <div>
      <h1>Visitas Ativas</h1>
      <p>Visitantes atualmente no edifício</p>
    </div>

    <div class="counter-pill">
      <span class="dot"></span>
      {{ totalAtivos }} visitante{{ totalAtivos !== 1 ? 's' : '' }} no edifício
    </div>
  </div>

  <div class="box">
    <div class="box-head">
      <div class="title-left">
        <div class="round-icon">
          <mat-icon>access_time</mat-icon>
        </div>
        <div>
          <h2>Lista de Visitantes</h2>
          <p>Visitantes que ainda não registaram saída</p>
        </div>
      </div>

      <mat-form-field class="search" floatLabel="never" appearance="legacy">
        <mat-icon matPrefix>search</mat-icon>
        <input
          matInput
          placeholder="Pesquisar visitante..."
          [(ngModel)]="search"
        />
      </mat-form-field>
    </div>

    <div class="table-shell">
      <div class="table-header">
        <div class="th col-visitante">Visitante</div>
        <div class="th col-anfitriao">Anfitrião</div>
        <div class="th col-local">Localização</div>
        <div class="th col-motivo">Motivo</div>
        <div class="th col-hora">Entrada</div>
        <div class="th col-dur">Duração</div>
        <div class="th col-actions">Ações</div>
      </div>

      <div
        class="table-row"
        *ngFor="let v of filteredVisits"
      >
        <div class="td col-visitante">
          <div class="avatar">{{ initials(v.nome) }}</div>
          <div class="v-stack">
            <div class="name">{{ v.nome }}</div>
            <div class="sub">{{ v.empresa }}</div>
          </div>
        </div>

        <div class="td col-anfitriao">
          <mat-icon class="inline-icon">person_outline</mat-icon>
          <span>{{ v.anfitriao }}</span>
        </div>

        <div class="td col-local">
          <div class="loc-line">
            <mat-icon class="inline-icon">location_city</mat-icon>
            <span>{{ v.departamento }}</span>
          </div>
          <div class="sub small">
            <mat-icon class="inline-icon small">room</mat-icon>
            {{ v.sala }}
          </div>
        </div>

        <div class="td col-motivo">
          <span class="badge">{{ v.motivo }}</span>
        </div>

        <div class="td col-hora">
          {{ v.entrada }}
        </div>

        <div class="td col-dur">
          <mat-icon class="inline-icon">access_time</mat-icon>
          <span>{{ formatDuration(v.duracaoMin) }}</span>
        </div>

        <div class="td col-actions">
          <button class="exit-btn" mat-button (click)="onOpenConfirm(v)">
            <mat-icon>exit_to_app</mat-icon>
            Registar Saída
          </button>
        </div>
      </div>

      <div class="empty" *ngIf="!filteredVisits.length">
        Nenhum visitante ativo no momento.
      </div>
    </div>
  </div>
</div>

<!-- overlay + modal -->
<div class="overlay" *ngIf="showingConfirm"></div>

<div class="confirm-modal" *ngIf="showingConfirm">
  <h3>Registar Saída</h3>
  <p>Confirma que deseja registar a saída deste visitante?</p>

  <div class="actions">
    <button class="btn-cancel" mat-button (click)="onCancelExit()">
      Cancelar
    </button>
    <button class="btn-confirm" mat-button (click)="onConfirmExit()">
      Confirmar Saída
    </button>
  </div>
</div>

<!-- toast -->
<div class="toast" *ngIf="showToast">
  <mat-icon>check_circle</mat-icon>
  <div>
    <div class="t-title">Saída registada com sucesso!</div>
    <div class="t-sub">{{ lastToastMsg }}</div>
  </div>
</div>
