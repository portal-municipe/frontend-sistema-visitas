<div class="visit-shell">
  <!-- toast -->
  <div class="toast" *ngIf="showSuccess">
    <div class="toast-icon">
      <mat-icon>check_circle</mat-icon>
    </div>
    <div>
      <div class="toast-title">Visita registada com sucesso!</div>
      <div class="toast-sub">Visitante: {{ selectedVisitor?.nome }}</div>
    </div>
  </div>

  <header class="page-head">
    <h1>Cadastrar Nova Visita</h1>
    <p>Registe a entrada de um visitante no edifício do MINFIN</p>
  </header>

  <!-- wizard -->
  <div class="wizard">
    <div class="wizard-step" [class.active]="step === 1" [class.done]="step > 1">
      <div class="wizard-circle">
        <span *ngIf="step === 1">1</span>
        <mat-icon *ngIf="step > 1">check</mat-icon>
      </div>
      <div class="wizard-text">
        <div class="wizard-title">Identificar Visitante</div>
        <div class="wizard-sub">Selecione ou registe o visitante</div>
      </div>
    </div>
    <div class="wizard-line" [class.done]="step > 1"></div>
    <div class="wizard-step" [class.active]="step === 2" [class.done]="step > 2">
      <div class="wizard-circle">
        <span *ngIf="step === 2">2</span>
        <mat-icon *ngIf="step > 2">check</mat-icon>
      </div>
      <div class="wizard-text">
        <div class="wizard-title">Dados do Visitante</div>
        <div class="wizard-sub">Confirme os dados pessoais</div>
      </div>
    </div>
    <div class="wizard-line" [class.done]="step > 2"></div>
    <div class="wizard-step" [class.active]="step === 3">
      <div class="wizard-circle"><span>3</span></div>
      <div class="wizard-text">
        <div class="wizard-title">Detalhes da Visita</div>
        <div class="wizard-sub">Informe os dados da visita</div>
      </div>
    </div>
  </div>

  <!-- STEP 1 -->
  <app-visit-step1-select
    *ngIf="step === 1"
    [visitors]="visitors"
    [selectedVisitor]="selectedVisitor"
    (visitorSelect)="onVisitorSelected($event)"
    (newVisitor)="onRegisterNewVisitor()"
    (next)="onStep1Next()"
  ></app-visit-step1-select>

  <!-- STEP 2 – confirmar existente -->
  <app-visit-step2-confirm
    *ngIf="step === 2 && !isNewVisitorFlow"
    [visitor]="selectedVisitor"
    (back)="onStep2Back()"
    (next)="onStep2Confirm()"
  ></app-visit-step2-confirm>

  <!-- STEP 2 – novo visitante -->
  <app-visit-step2-new
    *ngIf="step === 2 && isNewVisitorFlow"
    (back)="onStep2Back()"
    (saved)="onNewVisitorSaved($event)"
  ></app-visit-step2-new>

  <!-- STEP 3 -->
  <app-visit-step3-details
    *ngIf="step === 3"
    [hosts]="hosts"
    [departments]="departments"
    [motives]="motives"
    [areas]="areas"
    (back)="onStep3Back()"
    (submitVisit)="onVisitSubmit($event)"
  ></app-visit-step3-details>
</div>
